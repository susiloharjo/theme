<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8" *ngIf="customer">
    <!-- Header Section -->
    <div class="mb-6 flex flex-col sm:flex-row sm:items-center justify-between gap-4">
        <div>
            <div class="flex items-center gap-3">
                <h1 class="text-2xl font-bold text-gray-900">{{ customer.name }}</h1>
                <span
                    class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 uppercase">
                    {{ customer.status }}
                </span>
            </div>
            <p class="text-sm text-gray-500 mt-1 flex items-center gap-2">
                <span>{{ customer.code }}</span>
                <span class="w-1 h-1 bg-gray-300 rounded-full"></span>
                <span>{{ customer.industryName }}</span>
                <span class="w-1 h-1 bg-gray-300 rounded-full"></span>
                <span class="flex items-center gap-1">
                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    Owner: {{ customer.ownerName }}
                </span>
            </p>
        </div>
        <div class="flex items-center gap-2">
            <button
                class="btn border border-[#0a6ed1] text-[#0a6ed1] hover:bg-blue-50 px-4 py-2 rounded-lg text-sm font-semibold">
                Edit Customer
            </button>
            <button
                class="btn bg-[#0a6ed1] text-white hover:bg-blue-700 px-4 py-2 rounded-lg text-sm font-semibold shadow-sm">
                + New Opportunity
            </button>
        </div>
    </div>

    <!-- Layout: 2 Columns -->
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">

        <!-- MAIN CONTENT (Left - 8 Cols) -->
        <div class="lg:col-span-8 space-y-6">

            <!-- Tabs Navigation -->
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-6 overflow-x-auto" aria-label="Tabs">
                    <button (click)="activeTab = 'overview'"
                        [ngClass]="activeTab === 'overview' ? 'border-[#0a6ed1] text-[#0a6ed1]' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                        Overview
                    </button>
                    <button (click)="activeTab = 'contacts'"
                        [ngClass]="activeTab === 'contacts' ? 'border-[#0a6ed1] text-[#0a6ed1]' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                        Contacts
                        <span class="ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"
                            *ngIf="contacts.length">{{ contacts.length }}</span>
                    </button>
                    <button (click)="activeTab = 'activities'"
                        [ngClass]="activeTab === 'activities' ? 'border-[#0a6ed1] text-[#0a6ed1]' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                        Activities
                    </button>
                    <button (click)="activeTab = 'opportunities'"
                        [ngClass]="activeTab === 'opportunities' ? 'border-[#0a6ed1] text-[#0a6ed1]' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                        Opportunities
                        <span class="ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"
                            *ngIf="opportunities.length">{{ opportunities.length }}</span>
                    </button>
                    <button (click)="activeTab = 'quotations'"
                        [ngClass]="activeTab === 'quotations' ? 'border-[#0a6ed1] text-[#0a6ed1]' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                        Quotations
                    </button>
                </nav>
            </div>

            <!-- Tab Content -->
            <div [ngSwitch]="activeTab">

                <!-- OVERVIEW TAB -->
                <div *ngSwitchCase="'overview'" class="space-y-6">
                    <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                        <h3 class="text-base font-semibold leading-6 text-gray-900 mb-4">Customer Information</h3>
                        <dl class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-6">
                            <div class="sm:col-span-1">
                                <dt class="text-sm font-medium text-gray-500">Industry</dt>
                                <dd class="mt-1 text-sm text-gray-900">{{ customer.industryName }}</dd>
                            </div>
                            <div class="sm:col-span-1">
                                <dt class="text-sm font-medium text-gray-500">Tax ID (NPWP)</dt>
                                <dd class="mt-1 text-sm text-gray-900">{{ customer.taxId }}</dd>
                            </div>
                            <div class="sm:col-span-2">
                                <dt class="text-sm font-medium text-gray-500">Address</dt>
                                <dd class="mt-1 text-sm text-gray-900">{{ customer.address }}<br>{{ customer.city }}, {{
                                    customer.country }}</dd>
                            </div>
                            <div class="sm:col-span-1">
                                <dt class="text-sm font-medium text-gray-500">Payment Terms</dt>
                                <dd class="mt-1 text-sm text-gray-900">{{ customer.paymentTerms }}</dd>
                            </div>
                            <div class="sm:col-span-1">
                                <dt class="text-sm font-medium text-gray-500">Website</dt>
                                <dd class="mt-1 text-sm text-[#0a6ed1] hover:underline cursor-pointer">{{
                                    customer.website || '-' }}</dd>
                            </div>
                        </dl>
                    </div>

                    <!-- Summary Cards -->
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                            <dt class="text-xs font-medium text-gray-500 uppercase tracking-wider">Total Orders</dt>
                            <dd class="mt-1 text-2xl font-semibold text-gray-900">12</dd>
                        </div>
                        <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                            <dt class="text-xs font-medium text-gray-500 uppercase tracking-wider">Open Opportunities
                            </dt>
                            <dd class="mt-1 text-2xl font-semibold text-gray-900">{{ opportunities.length }}</dd>
                        </div>
                        <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                            <dt class="text-xs font-medium text-gray-500 uppercase tracking-wider">Total Revenue</dt>
                            <dd class="mt-1 text-2xl font-semibold text-gray-900">IDR 1.2B</dd> <!-- Mocked for now -->
                        </div>
                    </div>
                </div>

                <!-- CONTACTS TAB -->
                <div *ngSwitchCase="'contacts'">
                    <div class="bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm">
                        <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center bg-gray-50">
                            <h3 class="text-base font-semibold text-gray-900">Contact Persons</h3>
                            <button class="text-sm text-[#0a6ed1] font-medium hover:text-blue-700">+ Add
                                Contact</button>
                        </div>
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Name</th>
                                    <th scope="col"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Position</th>
                                    <th scope="col"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Email</th>
                                    <th scope="col"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Phone</th>
                                    <th scope="col" class="relative px-6 py-3"><span class="sr-only">Edit</span></th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr *ngFor="let contact of contacts">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="text-sm font-medium text-gray-900">{{ contact.name }}</div>
                                            <span *ngIf="contact.isPrimary"
                                                class="ml-2 px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">Primary</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ contact.position }}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ contact.email }}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ contact.phone }}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                        <a href="#" class="text-indigo-600 hover:text-indigo-900">Edit</a>
                                    </td>
                                </tr>
                                <tr *ngIf="contacts.length === 0">
                                    <td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">No contacts
                                        found.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ACTIVITIES TAB -->
                <div *ngSwitchCase="'activities'">

                    <!-- EMAIL INBOX VIEW -->
                    <div *ngIf="composerTab === 'email'"
                        class="bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm">
                        <div class="border-b border-gray-200 px-4 py-3 bg-gray-50">
                            <div class="flex items-center justify-between">
                                <h3 class="text-sm font-semibold text-gray-900">Inbox</h3>
                                <span class="text-xs text-gray-500">{{ emailActivities.length }} emails</span>
                            </div>
                        </div>

                        <!-- Email List -->
                        <div class="divide-y divide-gray-200">
                            <div *ngFor="let email of emailActivities"
                                class="px-4 py-3 hover:bg-gray-50 cursor-pointer transition-colors"
                                [class.bg-blue-50]="!email.isRead" [class.font-normal]="email.isRead"
                                [class.font-semibold]="!email.isRead">

                                <div class="flex items-start gap-3">
                                    <!-- Checkbox -->
                                    <input type="checkbox" class="mt-1 h-4 w-4 rounded border-gray-300 text-blue-600">

                                    <!-- Unread indicator -->
                                    <div class="mt-1.5">
                                        <div *ngIf="!email.isRead" class="w-2 h-2 bg-blue-600 rounded-full"></div>
                                        <div *ngIf="email.isRead" class="w-2 h-2"></div>
                                    </div>

                                    <!-- Email content -->
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-start justify-between gap-2">
                                            <div class="flex-1 min-w-0">
                                                <p class="text-sm truncate" [class.text-gray-900]="!email.isRead"
                                                    [class.text-gray-600]="email.isRead">
                                                    {{ email.sender }}
                                                </p>
                                                <p class="text-sm mt-0.5 truncate" [class.text-gray-900]="!email.isRead"
                                                    [class.text-gray-700]="email.isRead">
                                                    {{ email.subject }}
                                                </p>
                                                <p class="text-xs text-gray-500 mt-1 truncate">
                                                    {{ email.preview }}
                                                </p>
                                            </div>
                                            <div class="text-xs text-gray-500 whitespace-nowrap">
                                                {{ email.activityDate | date:'MMM d, h:mm a' }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div *ngIf="emailActivities.length === 0"
                                class="px-4 py-8 text-center text-sm text-gray-500">
                                No emails yet.
                            </div>
                        </div>
                    </div>

                    <!-- WHATSAPP CHAT VIEW -->
                    <div *ngIf="composerTab === 'whatsapp'"
                        class="bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm">
                        <div class="border-b border-gray-200 px-4 py-3 bg-gray-50">
                            <div class="flex items-center justify-between">
                                <h3 class="text-sm font-semibold text-gray-900">WhatsApp Conversation</h3>
                                <span class="text-xs text-gray-500">{{ whatsappActivities.length }} messages</span>
                            </div>
                        </div>

                        <!-- Chat Messages -->
                        <div class="p-4 space-y-4 max-h-[500px] overflow-y-auto bg-gray-50">
                            <div *ngFor="let message of whatsappActivities" class="flex gap-2"
                                [class.justify-end]="message.direction === 'sent'"
                                [class.justify-start]="message.direction === 'received'">

                                <!-- Avatar for received messages -->
                                <div *ngIf="message.direction === 'received'" class="flex-shrink-0">
                                    <div
                                        class="w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center text-xs font-semibold text-gray-700">
                                        {{ message.sender?.charAt(0) || 'A' }}
                                    </div>
                                </div>

                                <!-- Message bubble -->
                                <div class="flex flex-col max-w-[70%]" [class.items-end]="message.direction === 'sent'"
                                    [class.items-start]="message.direction === 'received'">
                                    <div class="rounded-lg px-4 py-2 shadow-sm"
                                        [class.bg-[#DCF8C6]]="message.direction === 'sent'"
                                        [class.bg-white]="message.direction === 'received'">
                                        <p class="text-sm text-gray-900 whitespace-pre-wrap">{{ message.messageText ||
                                            message.notes }}</p>
                                    </div>
                                    <span class="text-xs text-gray-500 mt-1 px-1">
                                        {{ message.activityDate | date:'MMM d, h:mm a' }}
                                    </span>
                                </div>

                                <!-- Avatar for sent messages (you) -->
                                <div *ngIf="message.direction === 'sent'" class="flex-shrink-0">
                                    <div
                                        class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-xs font-semibold text-white">
                                        {{ message.creatorName?.charAt(0) || 'J' }}
                                    </div>
                                </div>
                            </div>

                            <div *ngIf="whatsappActivities.length === 0" class="text-center text-sm text-gray-500 py-8">
                                No WhatsApp messages yet.
                            </div>
                        </div>
                    </div>

                    <!-- Activity Composer -->
                    <div class="bg-white border border-gray-200 rounded-lg mt-8 shadow-sm overflow-hidden">
                        <!-- Composer Tabs -->
                        <div class="flex border-b border-gray-200 bg-gray-50">
                            <button (click)="composerTab = 'email'" [class.bg-white]="composerTab === 'email'"
                                [class.text-[#0a6ed1]]="composerTab === 'email'"
                                [class.border-b-2]="composerTab === 'email'"
                                [class.border-blue-500]="composerTab === 'email'"
                                class="px-6 py-3 text-sm font-medium text-gray-600 hover:text-gray-800 focus:outline-none flex items-center gap-2 transition-colors relative top-[1px]">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z">
                                    </path>
                                </svg>
                                Email
                            </button>
                            <button (click)="composerTab = 'whatsapp'" [class.bg-white]="composerTab === 'whatsapp'"
                                [class.text-[#25D366]]="composerTab === 'whatsapp'"
                                [class.border-b-2]="composerTab === 'whatsapp'"
                                [class.border-[#25D366]]="composerTab === 'whatsapp'"
                                class="px-6 py-3 text-sm font-medium text-gray-600 hover:text-gray-800 focus:outline-none flex items-center gap-2 transition-colors relative top-[1px]">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                    <path
                                        d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z" />
                                </svg>
                                WhatsApp
                            </button>
                        </div>

                        <!-- EMAIL COMPOSER -->
                        <div class="p-6" *ngIf="composerTab === 'email'">
                            <div class="space-y-4">
                                <div class="grid grid-cols-1 gap-4">
                                    <div>
                                        <label class="label">Subject</label>
                                        <input type="text" class="input" placeholder="e.g., Follow up on proposal">
                                    </div>
                                    <div class="flex gap-4">
                                        <div class="w-1/2">
                                            <label class="label">To</label>
                                            <select class="input">
                                                <option *ngFor="let c of contacts" [value]="c.email">{{ c.name }} <{{
                                                        c.email }}>
                                                </option>
                                            </select>
                                        </div>
                                        <div class="w-1/2">
                                            <label class="label">CC</label>
                                            <input type="text" class="input" placeholder="Add CC...">
                                        </div>
                                    </div>
                                </div>

                                <!-- Rich Text Editor -->
                                <div class="border border-border rounded-md overflow-hidden">
                                    <!-- Toolbar -->
                                    <div
                                        class="bg-gray-50 border-b border-border px-3 py-2 flex items-center gap-1 flex-wrap">
                                        <select class="text-xs border-border rounded h-7 py-0 pl-2 pr-6 mr-2 bg-white">
                                            <option>Normal</option>
                                            <option>Heading 1</option>
                                            <option>Heading 2</option>
                                        </select>
                                        <div class="h-4 w-px bg-gray-300 mx-1"></div>
                                        <button class="p-1 hover:bg-gray-200 rounded text-gray-600" title="Bold">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M6 4h8a4 4 0 014 4 4 4 0 01-4 4H6z"></path>
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M6 12h9a4 4 0 014 4 4 4 0 01-4 4H6z"></path>
                                            </svg>
                                        </button>
                                        <button class="p-1 hover:bg-gray-200 rounded text-gray-600" title="Italic">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                                            </svg>
                                        </button>
                                        <button class="p-1 hover:bg-gray-200 rounded text-gray-600" title="Underline">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M6 10a2 2 0 002-2V6a2 2 0 00-2-2H4a2 2 0 00-2 2v2a2 2 0 002 2zm10-4a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V8a2 2 0 012-2h2zM6 20h12">
                                                </path>
                                            </svg>
                                        </button>
                                        <div class="h-4 w-px bg-gray-300 mx-1"></div>
                                        <button class="p-1 hover:bg-gray-200 rounded text-gray-600" title="Link">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"></path>
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71">
                                                </path>
                                            </svg>
                                        </button>
                                        <button class="p-1 hover:bg-gray-200 rounded text-gray-600" title="Image">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                                                </path>
                                            </svg>
                                        </button>
                                        <div class="h-4 w-px bg-gray-300 mx-1"></div>
                                        <button class="p-1 hover:bg-gray-200 rounded text-gray-600" title="List">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M4 6h16M4 12h16M4 18h16"></path>
                                            </svg>
                                        </button>
                                    </div>
                                    <!-- Editable Area -->
                                    <div class="min-h-[150px] p-4 text-sm text-gray-800 focus:outline-none"
                                        contenteditable="true">
                                        Hi Team,<br><br>I wanted to check on the status of our proposal...
                                    </div>
                                </div>
                                <div class="flex justify-between items-center mt-2">
                                    <div class="flex gap-2">
                                        <button
                                            class="text-xs text-gray-500 hover:text-gray-700 flex items-center gap-1">
                                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13">
                                                </path>
                                            </svg>
                                            Attach File
                                        </button>
                                    </div>
                                    <div class="flex gap-2">
                                        <button class="btn btn-outline">Draft</button>
                                        <button class="btn btn-primary">Send Email</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- WHATSAPP COMPOSER -->
                        <div class="p-6" *ngIf="composerTab === 'whatsapp'">
                            <div class="space-y-4">
                                <div>
                                    <label class="label">To (Phone)</label>
                                    <select class="input focus:border-[#25D366] focus:ring-[#25D366]">
                                        <option *ngFor="let c of contacts" [value]="c.phone">{{ c.name }} ({{ c.phone
                                            }})</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="label">Message</label>
                                    <textarea rows="4" class="input focus:border-[#25D366] focus:ring-[#25D366]"
                                        placeholder="Type your WhatsApp message here..."></textarea>
                                </div>
                                <div class="flex justify-end pt-2">
                                    <button
                                        class="btn bg-[#25D366] text-white hover:bg-green-600 focus:ring-green-500 shadow-sm flex items-center gap-2">
                                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                            <path
                                                d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z" />
                                        </svg>
                                        Send
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- OPPORTUNITIES TAB -->
                <div *ngSwitchCase="'opportunities'">
                    <!-- Simple list for now -->
                    <div class="bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Stage
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                        Probability</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">
                                        Expected Value</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Close
                                        Date</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                <tr *ngFor="let opp of opportunities">
                                    <td
                                        class="px-6 py-4 text-sm font-medium text-blue-600 cursor-pointer hover:underline">
                                        {{ opp.name }}</td>
                                    <td class="px-6 py-4 text-sm text-gray-500">{{ opp.stageName }}</td>
                                    <td class="px-6 py-4 text-sm text-gray-500">{{ opp.probability }}%</td>
                                    <td class="px-6 py-4 text-right text-sm text-gray-900 font-semibold">{{
                                        opp.expectedValue | currency:'IDR':'symbol':'1.0-0' }}</td>
                                    <td class="px-6 py-4 text-right text-sm text-gray-500">{{ opp.expectedCloseDate |
                                        date }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- QUOTATIONS TAB -->
                <div *ngSwitchCase="'quotations'">
                    <p class="text-gray-500 italic">Quotations list coming soon...</p>
                </div>

            </div>
        </div>

        <!-- RIGHT SIDEBAR (Sticky) -->
        <div class="lg:col-span-4 space-y-6">
            <!-- Next Actions Card -->
            <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                <h3 class="text-base font-semibold text-gray-900 mb-4">Pending Tasks</h3>
                <div class="space-y-3">
                    <div class="flex items-start gap-3">
                        <input type="checkbox" class="mt-1 h-4 w-4 text-blue-600 rounded border-gray-300">
                        <div class="text-sm">
                            <p class="font-medium text-gray-900">Follow up on contract</p>
                            <p class="text-gray-500 text-xs">Due tomorrow</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <input type="checkbox" class="mt-1 h-4 w-4 text-blue-600 rounded border-gray-300">
                        <div class="text-sm">
                            <p class="font-medium text-gray-900">Schedule demo</p>
                            <p class="text-gray-500 text-xs text-red-500">Overdue by 2 days</p>
                        </div>
                    </div>
                </div>
                <button class="mt-4 w-full text-center text-sm text-blue-600 font-medium hover:text-blue-700">View All
                    Tasks</button>
            </div>

            <!-- Tags/Segments -->
            <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                <h3 class="text-base font-semibold text-gray-900 mb-4">Tags</h3>
                <div class="flex flex-wrap gap-2">
                    <span
                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">VIP</span>
                    <span
                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">High
                        Volume</span>
                    <button
                        class="inline-flex items-center px-2 py-0.5 border border-dashed border-gray-300 rounded-full text-xs font-medium text-gray-500 hover:text-gray-900">+
                        Add</button>
                </div>
            </div>

        </div>
    </div>
</div>

<div *ngIf="!customer" class="p-12 text-center">
    <p class="text-gray-500 text-lg">Customer not found.</p>
    <button routerLink="/crm/customers" class="mt-4 text-blue-600 hover:underline">Back to List</button>
</div>