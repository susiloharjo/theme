<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8" *ngIf="customer">
    <!-- Header Section -->
    <div class="mb-6 flex flex-col sm:flex-row sm:items-center justify-between gap-4">
        <div>
            <div class="flex items-center gap-3">
                <h1 class="text-2xl font-bold text-gray-900">{{ customer.name }}</h1>
                <span
                    class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 uppercase">
                    {{ customer.status }}
                </span>
            </div>
            <p class="text-sm text-gray-500 mt-1 flex items-center gap-2">
                <span>{{ customer.code }}</span>
                <span class="w-1 h-1 bg-gray-300 rounded-full"></span>
                <span>{{ customer.industryName }}</span>
                <span class="w-1 h-1 bg-gray-300 rounded-full"></span>
                <span class="flex items-center gap-1">
                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    Owner: {{ customer.ownerName }}
                </span>
            </p>
        </div>
        <div class="flex items-center gap-2">
            <button
                class="btn border border-[#0a6ed1] text-[#0a6ed1] hover:bg-blue-50 px-4 py-2 rounded-lg text-sm font-semibold">
                Edit Customer
            </button>
            <button
                class="btn bg-[#0a6ed1] text-white hover:bg-blue-700 px-4 py-2 rounded-lg text-sm font-semibold shadow-sm">
                + New Opportunity
            </button>
        </div>
    </div>

    <!-- Layout: 2 Columns -->
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">

        <!-- MAIN CONTENT (Left - 8 Cols) -->
        <div class="lg:col-span-8 space-y-6">

            <!-- Tabs Navigation -->
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-6 overflow-x-auto" aria-label="Tabs">
                    <button (click)="activeTab = 'overview'"
                        [ngClass]="activeTab === 'overview' ? 'border-[#0a6ed1] text-[#0a6ed1]' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                        Overview
                    </button>
                    <button (click)="activeTab = 'contacts'"
                        [ngClass]="activeTab === 'contacts' ? 'border-[#0a6ed1] text-[#0a6ed1]' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                        Contacts
                        <span class="ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"
                            *ngIf="contacts.length">{{ contacts.length }}</span>
                    </button>
                    <button (click)="activeTab = 'activities'"
                        [ngClass]="activeTab === 'activities' ? 'border-[#0a6ed1] text-[#0a6ed1]' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                        Activities
                    </button>
                    <button (click)="activeTab = 'opportunities'"
                        [ngClass]="activeTab === 'opportunities' ? 'border-[#0a6ed1] text-[#0a6ed1]' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                        Opportunities
                        <span class="ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs"
                            *ngIf="opportunities.length">{{ opportunities.length }}</span>
                    </button>
                    <button (click)="activeTab = 'quotations'"
                        [ngClass]="activeTab === 'quotations' ? 'border-[#0a6ed1] text-[#0a6ed1]' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors">
                        Quotations
                    </button>
                </nav>
            </div>

            <!-- Tab Content -->
            <div [ngSwitch]="activeTab">

                <!-- OVERVIEW TAB -->
                <div *ngSwitchCase="'overview'" class="space-y-6">
                    <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                        <h3 class="text-base font-semibold leading-6 text-gray-900 mb-4">Customer Information</h3>
                        <dl class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-6">
                            <div class="sm:col-span-1">
                                <dt class="text-sm font-medium text-gray-500">Industry</dt>
                                <dd class="mt-1 text-sm text-gray-900">{{ customer.industryName }}</dd>
                            </div>
                            <div class="sm:col-span-1">
                                <dt class="text-sm font-medium text-gray-500">Tax ID (NPWP)</dt>
                                <dd class="mt-1 text-sm text-gray-900">{{ customer.taxId }}</dd>
                            </div>
                            <div class="sm:col-span-2">
                                <dt class="text-sm font-medium text-gray-500">Address</dt>
                                <dd class="mt-1 text-sm text-gray-900">{{ customer.address }}<br>{{ customer.city }}, {{
                                    customer.country }}</dd>
                            </div>
                            <div class="sm:col-span-1">
                                <dt class="text-sm font-medium text-gray-500">Payment Terms</dt>
                                <dd class="mt-1 text-sm text-gray-900">{{ customer.paymentTerms }}</dd>
                            </div>
                            <div class="sm:col-span-1">
                                <dt class="text-sm font-medium text-gray-500">Website</dt>
                                <dd class="mt-1 text-sm text-[#0a6ed1] hover:underline cursor-pointer">{{
                                    customer.website || '-' }}</dd>
                            </div>
                        </dl>
                    </div>

                    <!-- Summary Cards -->
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                            <dt class="text-xs font-medium text-gray-500 uppercase tracking-wider">Total Orders</dt>
                            <dd class="mt-1 text-2xl font-semibold text-gray-900">12</dd>
                        </div>
                        <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                            <dt class="text-xs font-medium text-gray-500 uppercase tracking-wider">Open Opportunities
                            </dt>
                            <dd class="mt-1 text-2xl font-semibold text-gray-900">{{ opportunities.length }}</dd>
                        </div>
                        <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                            <dt class="text-xs font-medium text-gray-500 uppercase tracking-wider">Total Revenue</dt>
                            <dd class="mt-1 text-2xl font-semibold text-gray-900">IDR 1.2B</dd> <!-- Mocked for now -->
                        </div>
                    </div>
                </div>

                <!-- CONTACTS TAB -->
                <div *ngSwitchCase="'contacts'">
                    <div class="bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm">
                        <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center bg-gray-50">
                            <h3 class="text-base font-semibold text-gray-900">Contact Persons</h3>
                            <button class="text-sm text-[#0a6ed1] font-medium hover:text-blue-700">+ Add
                                Contact</button>
                        </div>
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Name</th>
                                    <th scope="col"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Position</th>
                                    <th scope="col"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Email</th>
                                    <th scope="col"
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Phone</th>
                                    <th scope="col" class="relative px-6 py-3"><span class="sr-only">Edit</span></th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr *ngFor="let contact of contacts">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="flex items-center">
                                            <div class="text-sm font-medium text-gray-900">{{ contact.name }}</div>
                                            <span *ngIf="contact.isPrimary"
                                                class="ml-2 px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">Primary</span>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ contact.position }}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ contact.email }}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ contact.phone }}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                        <a href="#" class="text-indigo-600 hover:text-indigo-900">Edit</a>
                                    </td>
                                </tr>
                                <tr *ngIf="contacts.length === 0">
                                    <td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">No contacts
                                        found.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ACTIVITIES TAB -->
                <div *ngSwitchCase="'activities'">
                    <!-- Placeholder Activity Timeline - Next Task is to separate this into component -->
                    <div class="flow-root">
                        <ul role="list" class="-mb-8">
                            <li *ngFor="let activity of activities; let last = last">
                                <div class="relative pb-8">
                                    <span *ngIf="!last" class="absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-200"
                                        aria-hidden="true"></span>
                                    <div class="relative flex space-x-3">
                                        <div>
                                            <span
                                                class="h-8 w-8 rounded-full flex items-center justify-center ring-8 ring-white"
                                                [ngClass]="{
                                                    'bg-blue-500': activity.type === 'call',
                                                    'bg-green-500': activity.type === 'meeting',
                                                    'bg-gray-500': activity.type === 'email',
                                                    'bg-purple-500': activity.type === 'visit'
                                                }">
                                                <!-- Icons based on type -->
                                                <svg *ngIf="activity.type === 'email'" class="h-5 w-5 text-white"
                                                    fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                                </svg>
                                                <svg *ngIf="activity.type === 'call'" class="h-5 w-5 text-white"
                                                    fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                                                </svg>
                                                <svg *ngIf="activity.type === 'meeting' || activity.type === 'visit'"
                                                    class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24"
                                                    stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                                </svg>
                                            </span>
                                        </div>
                                        <div class="min-w-0 flex-1 pt-1.5 flex justify-between space-x-4">
                                            <div>
                                                <p class="text-sm text-gray-500"><span
                                                        class="font-medium text-gray-900">{{ activity.subject }}</span>
                                                    by <a href="#" class="font-medium text-gray-900">{{
                                                        activity.creatorName }}</a></p>
                                                <p class="text-sm text-gray-500 mt-1">{{ activity.notes }}</p>
                                            </div>
                                            <div class="text-right text-sm whitespace-nowrap text-gray-500">
                                                <time [attr.datetime]="activity.activityDate">{{ activity.activityDate |
                                                    date:'MMM d, y, h:mm a' }}</time>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li *ngIf="activities.length === 0" class="py-4 text-center text-sm text-gray-500">
                                No activities logged yet.
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- OPPORTUNITIES TAB -->
                <div *ngSwitchCase="'opportunities'">
                    <!-- Simple list for now -->
                    <div class="bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Stage
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                        Probability</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">
                                        Expected Value</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Close
                                        Date</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                <tr *ngFor="let opp of opportunities">
                                    <td
                                        class="px-6 py-4 text-sm font-medium text-blue-600 cursor-pointer hover:underline">
                                        {{ opp.name }}</td>
                                    <td class="px-6 py-4 text-sm text-gray-500">{{ opp.stageName }}</td>
                                    <td class="px-6 py-4 text-sm text-gray-500">{{ opp.probability }}%</td>
                                    <td class="px-6 py-4 text-right text-sm text-gray-900 font-semibold">{{
                                        opp.expectedValue | currency:'IDR':'symbol':'1.0-0' }}</td>
                                    <td class="px-6 py-4 text-right text-sm text-gray-500">{{ opp.expectedCloseDate |
                                        date }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- QUOTATIONS TAB -->
                <div *ngSwitchCase="'quotations'">
                    <p class="text-gray-500 italic">Quotations list coming soon...</p>
                </div>

            </div>
        </div>

        <!-- RIGHT SIDEBAR (Sticky) -->
        <div class="lg:col-span-4 space-y-6">
            <!-- Next Actions Card -->
            <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                <h3 class="text-base font-semibold text-gray-900 mb-4">Pending Tasks</h3>
                <div class="space-y-3">
                    <div class="flex items-start gap-3">
                        <input type="checkbox" class="mt-1 h-4 w-4 text-blue-600 rounded border-gray-300">
                        <div class="text-sm">
                            <p class="font-medium text-gray-900">Follow up on contract</p>
                            <p class="text-gray-500 text-xs">Due tomorrow</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <input type="checkbox" class="mt-1 h-4 w-4 text-blue-600 rounded border-gray-300">
                        <div class="text-sm">
                            <p class="font-medium text-gray-900">Schedule demo</p>
                            <p class="text-gray-500 text-xs text-red-500">Overdue by 2 days</p>
                        </div>
                    </div>
                </div>
                <button class="mt-4 w-full text-center text-sm text-blue-600 font-medium hover:text-blue-700">View All
                    Tasks</button>
            </div>

            <!-- Tags/Segments -->
            <div class="bg-white border border-gray-200 rounded-lg p-6 shadow-sm">
                <h3 class="text-base font-semibold text-gray-900 mb-4">Tags</h3>
                <div class="flex flex-wrap gap-2">
                    <span
                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">VIP</span>
                    <span
                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">High
                        Volume</span>
                    <button
                        class="inline-flex items-center px-2 py-0.5 border border-dashed border-gray-300 rounded-full text-xs font-medium text-gray-500 hover:text-gray-900">+
                        Add</button>
                </div>
            </div>

        </div>
    </div>
</div>

<div *ngIf="!customer" class="p-12 text-center">
    <p class="text-gray-500 text-lg">Customer not found.</p>
    <button routerLink="/crm/customers" class="mt-4 text-blue-600 hover:underline">Back to List</button>
</div>