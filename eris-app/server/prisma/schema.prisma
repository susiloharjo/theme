generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model WidgetTemplate {
  id            String            @id @default(uuid())
  name          String
  type          String
  defaultConfig String?
  widgets       DashboardWidget[]

  @@map("widget_templates")
}

model DashboardWidget {
  id          String         @id
  dashboardId String         @map("dashboard_id")
  templateId  String         @map("template_id")
  x           Int?
  y           Int?
  w           Int?
  h           Int?
  config      String?
  template    WidgetTemplate @relation(fields: [templateId], references: [id])

  @@map("dashboard_widgets")
}

model Widget {
  id          String  @id
  dashboardId String  @map("dashboard_id")
  title       String?
  type        String?
  x           Int?
  y           Int?
  w           Int?
  h           Int?
  value       String?
  content     String?
  icon        String?
  color       String?

  @@map("widgets")
}

model CrmCustomer {
  id           String   @id @default(uuid())
  code         String
  name         String
  industry     String
  status       String
  ownerName    String?
  lastActivity DateTime?
  revenue      Float?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("crm_customers")
}

model CrmOpportunity {
  id        String   @id @default(uuid())
  name      String
  account   String
  stage     String
  amount    Float
  closeDate DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("crm_opportunities")
}

model PmoProject {
  id          String   @id // Allowing manual ID like 'PROJ-001'
  name        String
  manager     String
  type        String
  status      String
  progress    Int
  health      String
  startDate   DateTime
  endDate     DateTime
  budget      String?
  description String?
  client      String?
  priority    String?
  location    String?

  // Complex Objects stored as JSON
  budgetStats  Json?
  riskStats    Json?
  taskStats    Json?
  team         Json?
  suppliers    Json?
  procurements Json?
  risks        Json?
  activityFeed Json?
  // We can add others as needed

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("pmo_projects")
}

model TrainingSession {
  id        String   @id // Manual IDs '1', '2' etc
  topic     String
  provider  String
  type      String
  location  String
  startDate DateTime
  endDate   DateTime
  status    String
  cost      String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("training_sessions")
}

// Super Search - Aggregated index table for cross-module search
// Data from CRM, PMO, Training, Purchase is flattened here
model SearchIndex {
  id            String   @id @default(uuid())
  objectType    String   @map("object_type")      // CRM | PMO | Training | Purchase
  objectId      String   @map("object_id")        // Original entity ID
  referenceNo   String?  @map("reference_no")     // Document code/number
  title         String
  subtitle      String?
  description   String?
  status        String?
  ownerId       String?  @map("owner_id")
  ownerName     String?  @map("owner_name")
  department    String?
  amount        Decimal?
  currency      String?
  datePrimary   DateTime? @map("date_primary")    // Document date / start date
  dateSecondary DateTime? @map("date_secondary")  // End date / due date
  tags          String[]
  searchText    String   @map("search_text")      // Concatenated searchable text
  permissions   String[]
  updatedAt     DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("search_index")
  @@index([objectType])
  @@index([status])
  @@index([ownerId])
  @@index([referenceNo])
}

model PurchaseRequest {
  id          String   @id // e.g. "PR-2025-001"
  title       String
  requester   String
  department  String
  requestDate DateTime
  totalAmount Decimal
  status      String   // "Completed", "In Progress", "Rejected"
  
  steps       Json?    // Storing steps as JSON to simplify migration

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  @@map("purchases")
}
